---
title: 异步
tags:
  - C#基础
categories:
  - C#基础
date: 2022-09-21 17:34:00概念
---

##### 概念

###### 同步与异步

* 同步：执行完一个任务之后才会执行下一个任务
* 异步：执行一个任务不管是否完成，就开始执行下一个任务，如果任务没有结果则任务完成之后会通过状态、通知、回调告知完成。

* 区别：任务之间是够会等待完成才开始执行。

###### 阻塞与非阻塞

* 阻塞：线程挂起，等待某个操作执行完成，期间CPU不会分给时间片给该线程，该线程无法执行其他工作。
* 非阻塞：就算某个方法没有执行完，线程也会返回。
* 区别：调用者是否一直等待结果，期间不执行其他代码。

###### 同步异步与阻塞非阻塞

* 区别：
  * 同步与异步关注的是如何得到结果以及得到结果后如何通知调用者完成
  * 阻塞与非阻塞关注的是如何等待结果，是线程等待着完成还是先做其他的事情等完成后通知、回调或者轮训状态。

##### 异步使用场景

* IO密集型：网络请求数据、数据库访问或者读写文件系统，这一类的操作CPU不直接参与，而是需要等待某些事情完成，使用按手印async/await并通过TaskCompletionSource来实现通知IO操作已经完成。
* CPU密集型：不包含各种IO操作

##### Async/Await关键字

* 作用：只是在方法中加入async关键字并没有什么作用，只是为了在方法中能够使用await关键字。而await的作用是，当Task任务未完成，会马上返回至调用者，相当于暂停方法的执行，并且在Task任务完成之后，根据同步上下文在原线程或者在线程池中挑选一个线程或者创建一个线程获得Task返回结果。如果发生异常则在现有的调用栈中重新抛出异常并继续执行后续代码。

##### 反编译代码

###### 只有Async

###### 有Async和Await

###### 返回`Task<void>`

###### 返回`Task<T>`

`补充中...`

##### 参考链接

https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/

https://docs.microsoft.com/en-us/dotnet/standard/async

https://docs.microsoft.com/en-us/dotnet/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap

https://devblogs.microsoft.com/dotnet/configureawait-faq

https://github.com/davidfowl/AspNetCoreDiagnosticScenarios/blob/master/AsyncGuidance.md
